<div class="app-container">
  <!-- Header (Only show when authenticated) -->
  <mat-toolbar
    color="primary"
    class="main-header"
    *ngIf="showHeader && currentUser"
  >
    <button mat-icon-button (click)="toggleSidebar()" class="menu-btn">
      <mat-icon>menu</mat-icon>
    </button>

    <div class="app-title" (click)="navigateTo('/dashboard')">
      <mat-icon>business</mat-icon>
      <span>{{ title }}</span>
    </div>

    <span class="spacer"></span>

    <!-- Quick Actions -->
    <div class="quick-actions" *ngIf="authService.isAdmin()">
      <button
        mat-icon-button
        matTooltip="Add Employee"
        (click)="router.navigate(['/employee/add'])"
      >
        <mat-icon>person_add</mat-icon>
      </button>
      <button
        mat-icon-button
        matTooltip="Import Data"
        (click)="router.navigate(['/employees'])"
      >
        <mat-icon>upload</mat-icon>
      </button>
      <button
        mat-icon-button
        matTooltip="Export Data"
        (click)="router.navigate(['/employees'])"
      >
        <mat-icon>download</mat-icon>
      </button>
    </div>

    <!-- User Menu -->
    <div class="user-info">
      <div class="user-details">
        <span class="user-name">{{ currentUser?.username }}</span>
        <span class="user-role">{{ userRole }}</span>
      </div>
      <button mat-icon-button [matMenuTriggerFor]="userMenu" class="user-btn">
        <div class="user-avatar">{{ userInitials }}</div>
      </button>
    </div>

    <mat-menu #userMenu="matMenu">
      <div class="user-menu-header">
        <div class="user-avatar-large">{{ userInitials }}</div>
        <div class="user-info-details">
          <strong>{{ currentUser?.username }}</strong>
          <span>{{ userRole }}</span>
          <small>{{ currentUser?.email || "user@example.com" }}</small>
        </div>
      </div>
      <mat-divider></mat-divider>
      <button mat-menu-item (click)="navigateTo('/profile')">
        <mat-icon>account_circle</mat-icon>
        <span>My Profile</span>
      </button>
      <button mat-menu-item (click)="navigateTo('/settings')">
        <mat-icon>settings</mat-icon>
        <span>Settings</span>
      </button>
      <mat-divider></mat-divider>
      <button mat-menu-item (click)="logout()">
        <mat-icon>logout</mat-icon>
        <span>Logout</span>
      </button>
    </mat-menu>
  </mat-toolbar>

  <!-- Main Content Area -->
  <div class="main-content" *ngIf="showHeader && currentUser">
    <!-- Sidebar Navigation -->
    <mat-sidenav-container class="sidenav-container">
      <mat-sidenav
        #sidenav
        mode="side"
        [opened]="isSidebarOpen"
        class="sidebar"
        [style.width]="isSidebarOpen ? '250px' : '64px'"
      >
        <mat-nav-list>
          <a
            mat-list-item
            *ngFor="let item of filteredNavItems"
            [routerLink]="item.route"
            routerLinkActive="active"
            [matTooltip]="!isSidebarOpen ? item.label : ''"
          >
            <mat-icon>{{ item.icon }}</mat-icon>
            <span *ngIf="isSidebarOpen" class="nav-label">{{
              item.label
            }}</span>
            <mat-icon
              *ngIf="item.roles.includes('ADMIN') && isSidebarOpen"
              class="admin-badge"
              matTooltip="Admin Only"
              >star</mat-icon
            >
          </a>
        </mat-nav-list>

        <!-- Sidebar Footer -->
        <div class="sidebar-footer" *ngIf="isSidebarOpen">
          <div class="system-status">
            <mat-icon class="status-icon online">fiber_manual_record</mat-icon>
            <span class="status-text">System Online</span>
          </div>
          <small class="version">v1.0.0</small>
        </div>
      </mat-sidenav>

      <!-- Main Content -->
      <mat-sidenav-content class="content-area">
        <div class="content-wrapper">
          <router-outlet></router-outlet>
        </div>
      </mat-sidenav-content>
    </mat-sidenav-container>
  </div>

  <!-- Auth Pages (Login) -->
  <div class="auth-content" *ngIf="!showHeader || !currentUser">
    <router-outlet></router-outlet>
  </div>

  <!-- Loading Overlay (Optional) -->
  <div class="loading-overlay" *ngIf="false">
    <mat-spinner diameter="50"></mat-spinner>
  </div>
</div>
